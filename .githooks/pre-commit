#!/bin/sh

# staged íŒŒì¼ë§Œ ê°€ì ¸ì˜¤ê¸°
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.kt$')

if [ -z "$STAGED_FILES" ]; then
  echo "No Kotlin files staged. Skipping ktlint."
  exit 0
fi

echo "Running ktlintFormat on staged files..."
./gradlew ktlintFormat > /dev/null

# ë³€ê²½ëœ íŒŒì¼ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ìŠ¤í…Œì´ì§€
MODIFIED_FILES=$(git diff --name-only)

if [ -n "$MODIFIED_FILES" ]; then
  echo "Detected changes after ktlintFormat. Re-staging modified files..."
  echo "$MODIFIED_FILES" | xargs git add
  echo "ğŸ”„ Files reformatted. Please re-commit your changes."
  exit 1
fi

echo "âœ… Ktlint passed. Continuing with commit."
exit 0
